<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:DengXian;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"等线 Light";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:SimSun-ExtB;
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:"Heiti SC Medium";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:微软雅黑;
	panose-1:2 11 5 3 2 2 4 2 2 4;}
@font-face
	{font-family:Baskerville;
	panose-1:2 2 5 2 7 4 1 2 3 3;}
@font-face
	{font-family:华文中宋;
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@等线 Light";}
@font-face
	{font-family:"\@Heiti SC Medium";}
@font-face
	{font-family:"\@等线";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"\@微软雅黑";}
@font-face
	{font-family:"\@华文中宋";}
@font-face
	{font-family:"\@SimSun-ExtB";}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:DengXian;}
h1
	{mso-style-link:"标题 1 字符";
	margin-top:17.0pt;
	margin-right:0cm;
	margin-bottom:16.5pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	line-height:240%;
	page-break-after:avoid;
	font-size:22.0pt;
	font-family:DengXian;}
p.MsoNormalIndent, li.MsoNormalIndent, div.MsoNormalIndent
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoListBullet, li.MsoListBullet, div.MsoListBullet
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:21.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoListBulletCxSpFirst, li.MsoListBulletCxSpFirst, div.MsoListBulletCxSpFirst
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:21.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoListBulletCxSpMiddle, li.MsoListBulletCxSpMiddle, div.MsoListBulletCxSpMiddle
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:21.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoListBulletCxSpLast, li.MsoListBulletCxSpLast, div.MsoListBulletCxSpLast
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:21.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoListNumber, li.MsoListNumber, div.MsoListNumber
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:47.25pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoListNumberCxSpFirst, li.MsoListNumberCxSpFirst, div.MsoListNumberCxSpFirst
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:47.25pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoListNumberCxSpMiddle, li.MsoListNumberCxSpMiddle, div.MsoListNumberCxSpMiddle
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:47.25pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoListNumberCxSpLast, li.MsoListNumberCxSpLast, div.MsoListNumberCxSpLast
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:47.25pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"标题 字符";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	text-align:center;
	font-size:16.0pt;
	font-family:"等线 Light";
	font-weight:bold;}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{mso-style-link:"正文文本 字符";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:DengXian;}
p.MsoBodyTextFirstIndent, li.MsoBodyTextFirstIndent, div.MsoBodyTextFirstIndent
	{mso-style-link:"正文文本首行缩进 字符";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:21.0pt;
	font-size:10.5pt;
	font-family:DengXian;}
a:link, span.MsoHyperlink
	{color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
p.1, li.1, div.1
	{mso-style-name:1正文;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	text-indent:21.0pt;
	font-size:14.0pt;
	font-family:DengXian;
	color:black;}
span.a
	{mso-style-name:"正文文本 字符";
	mso-style-link:正文文本;}
span.a0
	{mso-style-name:"正文文本首行缩进 字符";
	mso-style-link:正文文本首行缩进;}
p.a1, li.a1, div.a1
	{mso-style-name:章;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	text-align:center;
	font-size:22.0pt;
	font-family:"等线 Light";
	font-weight:bold;}
span.a2
	{mso-style-name:"标题 字符";
	mso-style-link:标题;
	font-family:"等线 Light";
	font-weight:bold;}
p.a3, li.a3, div.a3
	{mso-style-name:节;
	margin-top:17.0pt;
	margin-right:0cm;
	margin-bottom:16.5pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	line-height:240%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:DengXian;
	font-weight:bold;}
span.10
	{mso-style-name:"标题 1 字符";
	mso-style-link:"标题 1";
	font-weight:bold;}
p.a4, li.a4, div.a4
	{mso-style-name:中文正文;
	margin-top:7.8pt;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	text-indent:28.0pt;
	line-height:21.0pt;
	font-size:14.0pt;
	font-family:"Baskerville",serif;
	color:#1A1A1A;}
p.a5, li.a5, div.a5
	{mso-style-name:符号列表;
	margin-top:15.6pt;
	margin-right:10.5pt;
	margin-bottom:20.0pt;
	margin-left:50.25pt;
	text-indent:-24.0pt;
	line-height:19.0pt;
	font-size:12.0pt;
	font-family:DengXian;
	color:#595959;}
p.a6, li.a6, div.a6
	{mso-style-name:数字列表;
	margin-top:15.6pt;
	margin-right:10.5pt;
	margin-bottom:20.0pt;
	margin-left:47.25pt;
	text-indent:-21.0pt;
	line-height:19.0pt;
	font-size:12.0pt;
	font-family:DengXian;
	color:#767171;}
p.a6CxSpFirst, li.a6CxSpFirst, div.a6CxSpFirst
	{mso-style-name:数字列表CxSpFirst;
	margin-top:15.6pt;
	margin-right:10.5pt;
	margin-bottom:0cm;
	margin-left:47.25pt;
	margin-bottom:.0001pt;
	text-indent:-21.0pt;
	line-height:19.0pt;
	font-size:12.0pt;
	font-family:DengXian;
	color:#767171;}
p.a6CxSpMiddle, li.a6CxSpMiddle, div.a6CxSpMiddle
	{mso-style-name:数字列表CxSpMiddle;
	margin-top:0cm;
	margin-right:10.5pt;
	margin-bottom:0cm;
	margin-left:47.25pt;
	margin-bottom:.0001pt;
	text-indent:-21.0pt;
	line-height:19.0pt;
	font-size:12.0pt;
	font-family:DengXian;
	color:#767171;}
p.a6CxSpLast, li.a6CxSpLast, div.a6CxSpLast
	{mso-style-name:数字列表CxSpLast;
	margin-top:0cm;
	margin-right:10.5pt;
	margin-bottom:20.0pt;
	margin-left:47.25pt;
	text-indent:-21.0pt;
	line-height:19.0pt;
	font-size:12.0pt;
	font-family:DengXian;
	color:#767171;}
p.a7, li.a7, div.a7
	{mso-style-name:命令行;
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Courier New";
	text-decoration:underline;}
.MsoChpDefault
	{font-family:DengXian;}
 /* Page Definitions */
 @page WordSection1
	{size:595.0pt 842.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	layout-grid:15.6pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=ZH-CN link="#0563C1" vlink="#954F72" style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p class=a1><a name="_Toc534659675"><span style='font-family:"Heiti SC Medium"'>前言：你是我的菜</span></a></p>

<p class=a3><a name="_Toc534659676"></a><a name="_Toc529822019"><span
style='font-family:"微软雅黑",sans-serif'>有话要说</span></a></p>

<p class=a4><span style='font-family:华文中宋'>目前来说，国内高质量的既兼顾深入</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>系统，也兼顾系统编程，还兼顾普通</span><span
lang=EN-US>Mac</span><span style='font-family:华文中宋'>用户使用的书籍可谓是凤毛麟角，本书希望可以从一个角度开创这一先河。</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>拿到这本书的第一个疑问肯定是：软件安装有啥可说的，不都是拖放就可以了吗？</span><span
lang=EN-US><br>
<br>
</span><span style='font-family:华文中宋'>答：拖放方式是</span><span lang=EN-US>macOS</span><span
style='font-family:华文中宋'>安装软件的一种普遍方式，也还有其它功能更全的方式。剖析和理解</span><span lang=EN-US>macOS</span><span
style='font-family:华文中宋'>的软件安装原理也是深入理解</span><span lang=EN-US>macOS</span><span
style='font-family:华文中宋'>系统的一个敲门砖。</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>您可能还会问：这都是程序员们的事，跟我有何关系？</span><span lang=EN-US><br>
<br>
</span><span style='font-family:华文中宋'>答：大家都知道病从口入，而这软件安装就是最重要的入口之一。</span></p>

<p class=a4><span style='font-family:华文中宋'>当然，读者您还会有很多疑问，我们先不说软件安装包的事，下面先从软件安全方面略作一下分析。</span></p>

<p class=a4><span style='font-family:华文中宋'>在苹果电脑使用中，除了</span><span lang=EN-US>macOS</span><span
style='font-family:华文中宋'>系统自带的软件，下载安装其它软件是每个苹果用户都要做的，而且在使用过程中，也会不断地尝试新软件删除旧软件。从获得软件渠道的可信度角度来说，用户至少有三种获得软件的途径：</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>通过</span><span lang=EN-US>App</span><span
style='font-family:华文中宋'>商店购买和下载，目前这是公认的最安全的方式，所有软件都经苹果技术人员利用软件和人工严格的评估和检测，而且软件都是用苹果签发给软件开发商的有效证书签名的，这样可以保证软件的完整性。</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>公认的知名软件提供商的官网下载和安装，如</span><span lang=EN-US>Adobe</span><span
style='font-family:华文中宋'>，</span><span lang=EN-US>Microsoft</span><span
style='font-family:华文中宋'>等。这样获得的软件绝大多数情况也是使用有效证书签名的，可以保证代码的完整性未被篡改，软件本身的质量也有保证，这个渠道也被认为是安全的。还有一些有长期致力于苹果软件开发并被业界普遍软认可的软件开发商也可以归为此类。</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>信任度未知的渠道，这种程序多数不包含可验证证书，比如一些综合软件下载网站等，从这些地方获得的软件包无法保证它们不被篡改过。本人把开源软件也归为此类，因为没有人可以保证它不包含恶意的代码（有开源软件被发现包含恶意代码的实例），这种方式获得的软件相对来说是最不安全。</span></p>

<p class=a4><span style='font-family:华文中宋'>每个用户都有可能碰到使用这三种方式获得软件的时候，造成这种情况，有苹果电脑发展的历史原因，比如基于</span><span
lang=EN-US>Unix</span><span style='font-family:华文中宋'>系统的软件或者命令行工具等，大家可能知道用</span><span
lang=EN-US>Homebrew</span><span style='font-family:华文中宋'>，</span><span
lang=EN-US>MacPorts</span><span style='font-family:华文中宋'>或</span><span
lang=EN-US>Fink</span><span style='font-family:华文中宋'>等第三方工具管理；在没有应用商店（</span><span
lang=EN-US>App Store</span><span style='font-family:华文中宋'>）时就用而且持续更新的软件，比如</span><span
lang=EN-US>Titanium Software</span><span style='font-family:华文中宋'>的</span><span
lang=EN-US>Onyx</span><span style='font-family:华文中宋'>等；也有应用商店准入或收费制度等等诸多非技术因素，因为并不是所有软件都符合应用商店的严苛要求的，比如说</span><span
lang=EN-US>Adobe CC</span><span style='font-family:华文中宋'>的全家桶或者</span><span
lang=EN-US>Paragon NTFS for Mac</span><span style='font-family:华文中宋'>等等，举不胜举，也有不愿意迁移到应用商店等等各种理由。</span></p>

<p class=a4><span style='font-family:华文中宋'>对于从非应用商店下载下来的软件（后面我们会解释从应用商店安装软件的过程），第一步就是安装，从用户角度说，现在大多数软件都只是把</span><span
lang=EN-US>app</span><span style='font-family:华文中宋'>拖拽到应用程序文件夹就可以，给人的感觉：安装就是这么简单。但是，提醒读者注意的是，这种软件在初次启动时，绝大多数软件都会有一个初始化过程。</span></p>

<p class=a4><span style='font-family:华文中宋'>软件初始化过程可能仅仅涉及当前用户环境的配置和软件自身状态初始化的设置，也就是说只修改</span><span
lang=EN-US>/</span><span style='font-family:华文中宋'>访问用户文件夹下面的文件，那么它会默默地完成初始化，完全不用用户干预，给大家的感觉就是它直接就运行了。为什么可以这样呢？因为每个被运行的软件都会继承启动它的用户的身份（包括权限），这样在访问这个用户自己的资源时，使用的是这个用户的身份，当然就不需要额外的认证过程，就如同我们在访达（</span><span
lang=EN-US>Finder</span><span style='font-family:华文中宋'>）中进入用户个人文件夹中的任何一个子文件夹一样的无需再次输入密码（注：从</span><span
lang=EN-US>Mojave</span><span style='font-family:华文中宋'>开始，</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>加强了隐私访问控制，限制一个程序直接访问其它程序的文件数据。这一点与此处说的用户身份不冲突）。有时情况可能会变得比较复杂，比如软件可能需要变更某些操作系统的配置和环境，那么它必须要获得系统管理员的权限才能继续，比如：</span><span
lang=EN-US>Paragon NTFS For OS X</span><span style='font-family:华文中宋'>的安装等。</span></p>

<p class=a4><span style='font-family:华文中宋'>有些软件必须依赖一个安装过程，其中的原因多种多样。对于大型软件，如：</span><span
lang=EN-US>Adobe CC</span><span style='font-family:华文中宋'>全家桶，微软的</span><span
lang=EN-US>Office</span><span style='font-family:华文中宋'>以及金山的</span><span
lang=EN-US>WPS</span><span style='font-family:华文中宋'>套装等等，一个套装里包含多个软件，统一的安装过程给用户更好的体验；有的软件执意让用户阅读并同意软件许可证；有的软件安装时会要求输入必要信息；有的会让用户选择安装组件；有的软件依赖于其它软件，或者需要根据特定的版本等条件来自动确定安装过程。那么一个完整的互动的安装过程就是必要的了。</span></p>

<p class=a4><span style='font-family:华文中宋'>软件开发商会依照软件的需要或者自己的偏好选择一种最适合自己的安装方式。</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>系统上的软件安装至少有三种方式：</span></p>

<p class=a6CxSpFirst style='margin-left:24.0pt;text-indent:-24.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>App</span><span style='font-family:华文中宋'>程序本身自包含完整无需变更其它系统设置或不依赖于其它需另外安装的软件，这种软件的安装可以是将</span><span
lang=EN-US>app</span><span style='font-family:华文中宋'>程序直接拖拽到应用文件夹（</span><span
lang=EN-US>/Applications</span><span style='font-family:华文中宋'>）中，甚至是任意目录中就可以正常运行</span></p>

<p class=a6CxSpMiddle style='margin-left:24.0pt;text-indent:-24.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>App</span><span style='font-family:华文中宋'>程序自身内置初始安装代码，比如苹果出品的</span><span
lang=EN-US>server.app</span><span style='font-family:华文中宋'>和一些第三方软件。这种软件在第一次运行时完成自身初始化过程，初始化时很有可能需要用户输入管理员密码。这种方式对用户来说是最不透明的，除非有足够时间和技术，否则很难发现它在获得管理员权限后到底做了什么，潜在的危险是存在的</span></p>

<p class=a6CxSpLast style='margin-left:24.0pt;text-indent:-24.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:华文中宋'>三是使用</span><span lang=EN-US>macOS</span><span
style='font-family:华文中宋'>系统提供的“安装器“完成安装，这与</span><span lang=EN-US>PC</span><span
style='font-family:华文中宋'>机上用</span><span lang=EN-US>Windows</span><span
style='font-family:华文中宋'>安装器（</span><span lang=EN-US>msiexec.exe</span><span
style='font-family:华文中宋'>）是一样的。相对来说，这种方式比较透明，给与开发商和用户比较大的可控空间。</span></p>

<p class=a4><span style='font-family:华文中宋'>上面说的前两种，都是直接运行程序代码，对于我们普通用户没有多少可控的机会。对于最后一种方式，我们是可以通过一定技术在安装前就了解其如何操作的，做到安装前就心中有数，这也正是本书所要着重剖析的。虽然看上去，我们只能叙述其中的三分之一的可能，但是其实这个的比重以及重要性却是最举足轻重的，而且读者可以从中剖析和理解</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>的一些特性。</span></p>

<p class=a4><span style='font-family:华文中宋'>更重要的是，</span><span lang=EN-US>macOS</span><span
style='font-family:华文中宋'>系统还提供了一种命令行的方式，可以不显示安装包中的用户提示部分，也就是跳过那些安装步骤而自动完成安装，也就是悄无声息地完成软件安装。这个特性对很多场景都很有用，比如企业中的软件分发和部署等，当然可能也会带来安全风险。具体的技术细节也是本书中着重解析的一个部分。</span></p>

<p class=a3><a name="_Toc534659677"></a><a name="_Toc529822020"><span
style='font-family:"微软雅黑",sans-serif'>你是我的读者</span></a></p>

<p class=a4><span style='font-family:华文中宋'>前一节我们从软件第一次运行的角度，对软件初始化过程中的方方面面做了一个简单的说明。其实本书的内容和目的并不仅仅在于此，内容更广泛，技术更深入。</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>大众用户</span></p>

<p class=a4><span style='font-family:华文中宋'>对于个人用户来说，了解安装器工作过程和安装包格式，帮助读者深入了解</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>系统，本书为读者提供了相关基本的知识和工具，比如安装前先看看安装包里有什么，哪些文件会被安装到哪些目录中等等。安装前需要慎重对待来源和渠道不确定的软件，使用工具软件可以先大概了解一下这个软件是不是使用了可信的签名，如果答案是确定的，那么可信度会增加一分；看看它到底要做什么、安装了什么文件、会不会覆盖某些重要文件、哪些是不想安装的等等；当安装出了问题时，查看日志信息以便初步排错；即便自己无法解决，至少在网上询问他人或者向软件商提交错误报告的时候，可以提供更详细的信息等，</span>
<span style='font-family:华文中宋'>这样可大大提高获得准确有效及时帮助的几率。友情提示，要特别注意文件复制后的安装后期的操作情况，有助于判断其是否可信可靠。</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>网络多用户</span></p>

<p class=a4><span style='font-family:华文中宋'>随着</span><span lang=EN-US>Mac</span><span
style='font-family:华文中宋'>用户的增多，特别是在多用户网络环境中应用场景的迅速增多，管理员们面临着苹果电脑管理的迫切需求。目前有多种</span><span
lang=EN-US>Mac</span><span style='font-family:华文中宋'>管理工具可供管理员选择，无论是商业还是开源的移动设备管理系统，也就是</span><span
lang=EN-US>Mobile Device Management</span><span style='font-family:华文中宋'>（简称：</span><span
lang=EN-US>MDM</span><span style='font-family:华文中宋'>），还是使用传统的</span><span
lang=EN-US>UNIX</span><span style='font-family:华文中宋'>管理系统，如</span><span
lang=EN-US> Puppet, Salt</span><span style='font-family:华文中宋'>和</span><span
lang=EN-US>Chef</span><span style='font-family:华文中宋'>等；无论是利用</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>内置的描述文件（</span><span
lang=EN-US>Profile</span><span style='font-family:华文中宋'>），还是使用老式的</span><span
lang=EN-US>MCX</span><span style='font-family:华文中宋'>等来配置目标电脑；企业员工电脑部署策略无论是传统的安装系统镜像部署还是</span><span
lang=EN-US>BYOD</span><span style='font-family:华文中宋'>或者利用苹果的“设备登记计划”（</span><span
lang=EN-US>Device Enrollment Program</span><span style='font-family:华文中宋'>，简称</span><span
lang=EN-US> DEP</span><span style='font-family:华文中宋'>）；无论是使用苹果远程桌面（</span><span
lang=EN-US>Apple Remote Desktop</span><span style='font-family:华文中宋'>）还是使用</span><span
lang=EN-US>ssh</span><span style='font-family:华文中宋'>实现远程管理。显然这些都是管理员可以选择的工具和技术，具体到某一个企业会根据自身情况（网络、人员、技术储备、可移动性和管理条例等等）可能会选择综合使用某种或多种手段。无论哪种方式管理工具，无论是采用用户主动（</span><span
lang=EN-US>pull</span><span style='font-family:华文中宋'>）还是管理端主动（</span><span
lang=EN-US>push</span><span style='font-family:华文中宋'>）或综合模式，在实际工作中通常都会遇到部署途径问题。利用</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>的安装机制，在多种管理工具中都是一种基础技术手段。利用安装包远程无人干预实现到目标客户机的软件安装，用户和系统配置，更新库存信息，添加或移除软件、加密或解密，与公司数据同步等等工作。所以，一个管理员必须知道并熟练掌握程序打包和重新打包技术。</span></p>

<p class=a4><span style='font-family:华文中宋'>上面提到<a name=重新打包>两个说法，一个是</a><a
name=程序打包><b>程序打包</b></a>，就是将程序和脚本等按照</span><b><span
style='font-family:华文中宋'>安装器</span></b><span style='font-family:华文中宋'>的规定制作一个安装</span><span
lang=EN-US>pkg</span><span style='font-family:华文中宋'>文件的过程。另一个是说法是<b>重新打包</b></span><span
style='font-family:华文中宋'>，它们什么意思呢？我们举一个简单的重新打包的例子。比如，公司购买了</span><span
lang=EN-US>50</span><span style='font-family:华文中宋'>个</span><span lang=EN-US>ComicLife</span><span
style='font-family:华文中宋'>软件许可证（指非苹果公司提供的多用户许可证购买计划</span><span lang=EN-US>-VPP-</span><span
style='font-family:华文中宋'>购买的许可证），为了尽快给每个员工安装，除了要将</span><span lang=EN-US>app</span><span
style='font-family:华文中宋'>程序正确复制到</span><span lang=EN-US>/Applications</span><span
style='font-family:华文中宋'>（</span><span lang=EN-US>/</span><span
style='font-family:华文中宋'>应用）文件夹中，还应该将所购买的许可证一同安装到指定的位置（有时还会复制一些初始化文件给用户等）以避免软件提示用户自己输入许可证，并且确保各个文件的权限和属性等正确。对于这种情况，一种可行的方式是，将原软件的安装包打开或安装运行注册一次之后，将软件、许可证和其它信息等再制作成一个安装</span><span
lang=EN-US>pkg</span><span style='font-family:华文中宋'>文件，作为公司特有的安装包，用于发布内部软件。</span></p>

<p class=a4><span style='font-family:华文中宋'>在多用户环境中，手动复制文件的方式是最不可取的，步骤繁复容易出现人工操作纰漏；仅仅采用脚本也不太可靠，分散存放的文件不易管理。打包后部署有诸多好处，比如许可证管理和分发，用户启动软件就可以直接使用，而无需打电话向有关人员询问软件注册信息和注册步骤，这既方便了用户使用，保证软件在公司内部的统一完整和有效，也可以防止许可证被滥用。进一步，如果使用许可证管理系统的话，还可以将许可证的发放、回收和审计管理工作包含在安装包中，实现许可证管理自动化。而且在今后的软件升级过程中，利用以前的打包工程文件，快速制作升级安装包，避免不必要的失误。在分层级管理的环境里，不同的管理员都使用一致的方式完成工作，保证部门的工作一致而可靠。</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>程序开发者</span></p>

<p class=a4><span style='font-family:华文中宋'>对不不同的软件开发商或者开发者来说，本书也有一些参考作用。虽然</span><span
lang=EN-US>Xcode</span><span style='font-family:华文中宋'>等开发环境可以完成软件的打包，但开发者也可以根据软件的具体情况、版本管理、组件分发或个人偏好等，制作客户化的安装包，以满足不同目标用户的要求和场景。</span></p>

<p class=a3><a name="_Toc534659678"></a><a name="_Toc529822021"><span
style='font-family:"微软雅黑",sans-serif'>此书门槛高吗</span></a></p>

<p class=a4><span style='font-family:华文中宋'>关于软件打包，目前苹果还没有官方详细而系统的指南和说明，本书为个人用户、系统管理员和软件开发提供所需的入门和深入知识；并提供尽可能多的截图、代码和练习机会，有助于初学者学习和实际操作。初学者在初步了解基本概念（第</span><span
lang=EN-US>2</span><span style='font-family:华文中宋'>章）后，跟随本书的举例逐步熟悉和理解</span><span
lang=EN-US>Apple</span><span style='font-family:华文中宋'>安装包的概念，还能补充一些操作</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>的必要技能，也可以选择适合自己的方式，比如习惯于图形界面的读者可以只阅读有关图形程序操作的部分，等熟悉之后再涉足命令行的部分。</span></p>

<p class=a4><span style='font-family:华文中宋'>说到阅读本书所需的基本知识和技能，本书致力于从浅到深、层层递进，并且举例说明和展开的原则，介绍相关知识以满足最多层次读者的需求，读者可根据自己的现有知识和不同目的挑选章节和内容来读。</span></p>

<p class=a4><span style='font-family:华文中宋'>本书很多内容适用于没有太多系统知识的入门者，通过依照本书实例操作可以慢慢熟悉和理解</span><span
lang=EN-US>Mac</span><span style='font-family:华文中宋'>系统程序和打包的相关概念，从第二章到第四章都可以读懂。</span></p>

<p class=a4><span style='font-family:华文中宋'>如果你对</span><span lang=EN-US>Mac</span><span
style='font-family:华文中宋'>操作系统和文件系统等比较熟悉，但对使用命令不太习惯，那么加上二到四和第六章都不会有太多障碍，读完后可以做到熟练观察安装包和使用相关工具完成基础打包任务。</span></p>

<p class=a4><span style='font-family:华文中宋'>如果你对终端命令行感兴趣或比较熟悉，可以熟练使用和理解一些系统命令的使用，或者希望从本书入手学习一些初步使用终端和</span><span
lang=EN-US>Bash</span><span style='font-family:华文中宋'>外壳程序的知识，那么按照本书最后两章的实例尝试一些打包和测试任务，肯定可以学到更多知识；</span></p>

<p class=a4><span style='font-family:华文中宋'>如果你熟练编写各种脚本、有编程基础、希望全面掌握软件打包技术，那么通读完本书并做一些练习，如果可以结合自己的实际多练习，基本可以胜任任何环境和要求的软件打包、测试、排错等等的完整流程工作。</span></p>

<p class=a3><a name="_Toc534659679"></a><a name="_Toc529822022"><span
style='font-family:"微软雅黑",sans-serif'>如何读本书</span></a></p>

<p class=a4><span style='font-family:华文中宋'>读者可以参考所需的知识点跳跃阅读，下面概述每一章的内容：</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>本章：主要是介绍本书目的和本书所需的基础知识储备</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>第一章：介绍与本书一同使用的各种软件、参考书籍和软硬件测试环境的建立</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>第二章：解释安装器和安装包的绝大多数基础概念，以及如何实用软件检视现成安装包的内容</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>第三章：解释负载文件，通过例子使用多种手段（</span><span lang=EN-US>Shell</span><span
style='font-family:华文中宋'>命令和多个打包软件）来展示制作负载文件的安装包过程</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>第四章：通过例子介绍和解释安装包脚本及其规范和实用技术</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>第五章：解释产品包（分发包）的用途，并通过例子解释如何制作，并将负载文件和脚本二者融会贯通，以及脚本的高级用法。</span></p>

<p class=a5><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
style='font-family:华文中宋'>第六章</span> <span style='font-family:华文中宋'>详细解释如何使用命令行定制产品包和命令行安装。</span></p>

<p class=a3><a name="_Toc534659680"></a><a name="_Toc529822023"><span
style='font-family:"微软雅黑",sans-serif'>本书的约定</span></a></p>

<p class=a4><span style='font-family:华文中宋'>本书的举例，如果没有特殊声明，默认使用</span><span
lang=EN-US>macOS</span><span style='font-family:华文中宋'>系统自带的终端程序（</span><span
lang=EN-US>Terminal.app</span><span style='font-family:华文中宋'>），而且是</span><span
lang=EN-US>Bash</span><span style='font-family:华文中宋'>外壳程序。</span></p>

<p class=a4><span style='font-family:华文中宋'>文件和目录的写法：在</span><span lang=EN-US>macOS</span><span
style='font-family:华文中宋'>的中文界面中，很多文件和目录可能会被自动转化为中文，在中文系统中使用系统可识别的中文作为文件目录是被接受的，但为了通用，本书统一使用英文。比如根目录下的系统文件夹，我们写作</span><span
lang=EN-US>/System</span><span style='font-family:华文中宋'>；根目录的用户目录根，写作</span><span
lang=EN-US>/Users</span><span style='font-family:华文中宋'>。比如相当前用户的用户文件夹目录，写作</span><span
lang=EN-US>~</span><span style='font-family:华文中宋'>，所以当前用户的桌面是：</span><span
lang=EN-US>~/Desktop</span><span style='font-family:华文中宋'>。比如</span><span
lang=EN-US>Finder.pp</span><span style='font-family:华文中宋'>的全路径名是</span><span
lang=EN-US>/System/Library/CoreServices/Finder.app</span></p>

<p class=a4><span style='font-family:华文中宋'>书中会给出一些命令行举例，所以在涉及命令行的时候，命令行本身都以</span>
<span lang=EN-US>$ </span><span style='font-family:华文中宋'>符号</span><span
lang=EN-US>+</span><span style='font-family:华文中宋'>空格开始，后跟命令本身，比如：</span></p>

<p class=a7><span lang=EN-US>$ networksetup -printcommands</span></p>

<p class=a4><span style='font-family:华文中宋'>命令本身是</span><span lang=EN-US>“networksetup
-printcommands”</span><span style='font-family:华文中宋'>，读者只需复制命令本身并在终端中运行。</span></p>

<p class=a4><span style='font-family:华文中宋'>命令的输出，则没有前导</span> <span lang=EN-US>$
</span><span style='font-family:华文中宋'>符号，比如，</span><span lang=EN-US>&quot;df
-l&quot;</span><span style='font-family:华文中宋'>是命令本身，而后面的两行只是命令的输出部分：</span></p>

<p class=a7><span lang=EN-US>$ sw_vers</span></p>

<p class=a7><span lang=EN-US>ProductName: Mac OS X</span></p>

<p class=a7><span lang=EN-US>ProductVersion: 10.14</span></p>

<p class=a7><span lang=EN-US>BuildVersion:   18A391</span></p>

<p class=a4><span style='font-family:华文中宋'>在脚本中，每行命令都不包含前导</span> <span
lang=EN-US>$ </span><span style='font-family:华文中宋'>字符。</span></p>

<p class=a4><span style='font-family:华文中宋'>特别注意命令行中的每个空格，如果把握不住，可以复制命令到终端中，修改必要的参数后运行。</span></p>

<p class=a4><span style='font-family:华文中宋'>如果命令中需要用户输入适合用户环境的字符串时，我们用尖括号将其括起来，比如下面的</span><span
lang=EN-US>“ hostname”</span><span style='font-family:华文中宋'>就需要读者输入实际环境的值：</span></p>

<p class=a7><span lang=EN-US>$ ping &lt;hostname&gt;.local</span></p>

<p class=a4><span style='font-family:华文中宋'>涉及终端的命令和显示输出默认使用字体</span><span
lang=EN-US>Courier New</span><span style='font-family:华文中宋'>和</span><span
lang=EN-US>11</span><span style='font-family:华文中宋'>号大小。</span></p>

<p class=a4><span style='font-family:华文中宋'>因为读者使用的阅读设备和分辨率不同等原因，命令行和其输出可能会自动换行，甚至是被添加了连接号</span><span
lang=EN-US>(-)</span><span style='font-family:华文中宋'>，所以，阅读中请设置适合的屏幕和字号。</span></p>

<p class=a3><a name="_Toc534659681"></a><a name="_Toc529822024"><span
style='font-family:"微软雅黑",sans-serif'>关于作者</span></a></p>

<p class=a4><span style='font-family:华文中宋'>有十多年从事</span><span lang=EN-US>Mac</span><span
style='font-family:华文中宋'>管理的经验，所在部门管理着数万台</span><span lang=EN-US>Mac</span><span
style='font-family:华文中宋'>电脑。</span></p>

<p class=a4><span style='font-family:华文中宋'>从最开始接触</span><span lang=EN-US>Mac</span><span
style='font-family:华文中宋'>的懵懂无知，到逐渐熟悉，后来可以用命令行控制和简单操作，到后来可以用脚本实现复杂的任务，到现在逐步接入</span><span
lang=EN-US>DEP</span><span style='font-family:华文中宋'>和</span><span lang=EN-US>VPP</span><span
style='font-family:华文中宋'>计划。通过借鉴和总结前人的探索以及自己不断的摸索和工作中的实践，从使用到管理</span><span
lang=EN-US>Mac</span><span style='font-family:华文中宋'>，这其中走了不少弯路，也是一个自我磨练和提升的过程。</span></p>

<p class=a4><span style='font-family:华文中宋'>本人酷爱打排球，也是在女排精神中成长的一代。曾经的旱鸭子，</span><span
lang=EN-US>40</span><span style='font-family:华文中宋'>岁后在加拿大学会了游泳，这恐怕是个人最大的突破了。</span></p>

<p class=a3><a name="_Toc534659682"></a><a name="_Toc529822025"><span
style='font-family:"微软雅黑",sans-serif'>联系作者和反馈</span></a></p>

<p class=a4><span style='font-family:华文中宋'>请到我的</span><span lang=EN-US>Github</span><span
style='font-family:华文中宋'>中的窝里下载本书的例子和资源和其它脚本等</span><span lang=EN-US>: </span><span
class=MsoHyperlink><span lang=EN-US><a
href="https://github.com/Tonyliu2ca/Introducting_macOS_Packing">https://github.com/Tonyliu2ca/Introducting_macOS_Packing</a></span></span></p>

<p class=a4><span style='font-family:华文中宋'>欢迎对本书提出宝贵意见和告知勘误，本人以希望可以持续更新本书内容。</span></p>

<p class=a4><span style='font-family:华文中宋'>每个人都很忙，如果需要，可以通过下面的方式联系本人，本人也会尽最大努力给读者回馈。</span></p>

<p class=a4><span style='font-family:华文中宋'>博客：</span><span class=MsoHyperlink><span
lang=EN-US><a href="http://blog.csdn.net/cneducation">http://blog.csdn.net/cneducation</a></span></span></p>

<p class=a4><span lang=EN-US>GitHub</span><span style='font-family:华文中宋'>：</span><span
class=MsoHyperlink><span lang=EN-US><a href="https://github.com/Tonyliu2ca">Tonyliu2ca@github</a></span></span></p>

<p class=a4><span lang=EN-US>Twitter</span><span style='font-family:华文中宋'>：</span><span
lang=EN-US>@tonyliu2ca</span></p>

<p class=a3><a name="_Toc534659683"></a><a name="_Toc529822026"><span
style='font-family:"微软雅黑",sans-serif'>版权</span></a></p>

<p class=a7><span style='font-family:"微软雅黑",sans-serif'>版权</span><span
lang=EN-US> © 2017-</span><span style='font-family:"微软雅黑",sans-serif'>，</span> <span
style='font-family:"微软雅黑",sans-serif'>刘铁松</span></p>

<p class=a7><span style='font-family:"微软雅黑",sans-serif'>著作权由刘铁松所有。著作权人保留一切权利。</span></p>

<p class=a7><span style='font-family:"微软雅黑",sans-serif'>这份授权条款，在使用者符合以下四条件的情形下，授予使用者使用及再散播本</span></p>

<p class=a7><span style='font-family:"微软雅黑",sans-serif'>软件包装原始码及二进位可执行形式的权利，无论此包装是否经改作皆然：</span></p>

<p class=a7><span lang=EN-US>1. </span><span style='font-family:"微软雅黑",sans-serif'>对于本软件源代码的再散播，必须保留上述的版权宣告、此四条件表列，以及下述的免责声明。</span></p>

<p class=a7><span lang=EN-US>2. </span><span style='font-family:"微软雅黑",sans-serif'>对于本套件二进位可执行形式的再散播，必须连带以文件以及／或者其他附于散播包装中的媒介方式，重制上述之版权宣告、此四条件表列，以及下述的免责声明。</span></p>

<p class=a7><span lang=EN-US>3. </span><span style='font-family:"微软雅黑",sans-serif'>所有提及本软件功能或是本软件使用之宣传材料，都必须包还含下列之交待文字：</span></p>

<p class=a7><span lang=EN-US>“</span><span style='font-family:"微软雅黑",sans-serif'>本产品内含有由刘铁松及其软件贡献者所开发的软件。</span><span
lang=EN-US>”</span></p>

<p class=a7><span lang=EN-US>4. </span><span style='font-family:"微软雅黑",sans-serif'>未获事前取得书面许可，不得使用刘铁松或本软件贡献者之名称，来为本软件之衍生物做任何表示支持、认可或推广、促销之行为。</span></p>

<p class=a7><span style='font-family:"微软雅黑",sans-serif'>免责声明：本软件是由刘铁松及本软件之贡献者以现状（</span><span
lang=EN-US>&quot;as is&quot;</span><span style='font-family:"微软雅黑",sans-serif'>）提供，本软件包装不负任何明示或默示之担保责任，包括但不限于就适售性以及特定目的的适用性为默示性担保。刘铁松及本软件之贡献者，无论任何条件、无论成因或任何责任主义、无论此责任为因合约关系、无过失责任主义或因非违约之侵权（包括过失或其他原因等）而起，对于任何因使用本软件包装所产生的任何直接性、间接性、偶发性、特殊性、惩罚性或任何结果的损害（包括但不限于替代商品或劳务之购用、使用损失、资料损失、利益损失、业务中断等等），不负任何责任，即在该种使用已获事前告知可能会造成此类损害的情形下亦然。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

</body>

</html>
